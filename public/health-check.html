<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CareGrid Health Check</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:16px}
    .row{display:flex;align-items:center;gap:10px;margin:10px 0}
    .badge{padding:4px 8px;border-radius:999px;font-size:13px;color:#fff}
    .ok{background:#0ea862}.fail{background:#e53935}.info{background:#3b82f6}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
    .grid{display:grid;gap:10px}
  </style>
</head>
<body>
  <h1>CareGrid Health Check</h1>

  <div class="grid">
    <div class="row"><strong>Host:</strong> <span id="host"></span></div>
    <div class="row"><strong>Mode:</strong> <span id="mode" class="badge info">Detecting…</span></div>

    <div class="row">
      <strong>/health:</strong> <span id="health" class="badge info">Checking…</span>
      <small id="health-msg"></small>
    </div>

    <div class="row">
      <strong>/api/clinics?limit=1:</strong> <span id="api" class="badge info">Checking…</span>
      <small id="api-msg"></small>
    </div>
  </div>

  <p>Open DevTools Console for details.</p>

  <script>
    const $ = (id) => document.getElementById(id);
    $('host').textContent = location.origin;

    // Detect preview vs prod quickly
    const isPreview = /\.vercel\.app$/i.test(location.host) && /git-/.test(location.host);
    $('mode').textContent = isPreview ? 'Vercel Preview' : 'Production';

    async function probe(url, badgeId, msgId){
      try{
        const t0 = performance.now();
        const r = await fetch(url, { credentials: 'omit' });
        const ms = Math.round(performance.now() - t0);
        if(r.ok){
          $(badgeId).className = 'badge ok';
          $(badgeId).textContent = 'OK';
          $(msgId).textContent = `HTTP ${r.status} in ${ms}ms`;
        }else{
          $(badgeId).className = 'badge fail';
          $(badgeId).textContent = 'FAIL';
          $(msgId).textContent = `HTTP ${r.status} in ${ms}ms`;
        }
        return r;
      }catch(e){
        $(badgeId).className = 'badge fail';
        $(badgeId).textContent = 'FAIL';
        $(msgId).textContent = e.message.includes('CORS') ? 'Likely CORS blocked' : e.message;
        console.error('Probe error:', url, e);
      }
    }

    // Hit backend via the same origin. Vercel rewrite helps.
    probe('/health', 'health', 'health-msg');
    probe('/api/clinics?limit=1', 'api', 'api-msg');
  </script>
</body>
</html>