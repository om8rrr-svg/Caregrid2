<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connectivity Test - CareGrid</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .pending { background-color: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>CareGrid API Connectivity Test</h1>
    <p>Testing API endpoints and CORS functionality...</p>
    
    <button onclick="testHealthEndpoint()">Test Health Endpoint</button>
    <button onclick="testClinicsEndpoint()">Test Clinics Endpoint</button>
    <button onclick="testAuthEndpoint()">Test Auth Endpoint</button>
    <button onclick="runAllTests()">Run All Tests</button>
    
    <div id="results"></div>
    
    <script type="module" src="js/api-base.js?v=2025082510"></script>
    <script src="js/api-service.js?v=2025082509"></script>
    
    <script>
        function addResult(test, status, message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }
        
        async function testHealthEndpoint() {
            addResult('Health Check', 'pending', 'Testing...');
            try {
                const response = await fetch(buildUrl('api/health'));
                if (response.ok) {
                    const data = await response.json();
                    addResult('Health Check', 'success', `API is healthy: ${JSON.stringify(data)}`);
                } else {
                    addResult('Health Check', 'error', `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                addResult('Health Check', 'error', `Error: ${error.message}`);
            }
        }
        
        async function testClinicsEndpoint() {
            addResult('Clinics Endpoint', 'pending', 'Testing...');
            try {
                const response = await fetch(buildUrl('api/clinics'));
                if (response.ok) {
                    const data = await response.json();
                    addResult('Clinics Endpoint', 'success', `Found ${data.length || 0} clinics`);
                } else {
                    addResult('Clinics Endpoint', 'error', `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                addResult('Clinics Endpoint', 'error', `Error: ${error.message}`);
            }
        }
        
        async function testAuthEndpoint() {
            addResult('Auth Endpoint', 'pending', 'Testing...');
            try {
                const response = await fetch(buildUrl('api/auth/me'), {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (response.status === 401) {
                    addResult('Auth Endpoint', 'success', 'Auth endpoint responding correctly (401 Unauthorized as expected)');
                } else if (response.ok) {
                    addResult('Auth Endpoint', 'success', 'Auth endpoint responding correctly');
                } else {
                    addResult('Auth Endpoint', 'error', `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                addResult('Auth Endpoint', 'error', `Error: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            document.getElementById('results').innerHTML = '';
            addResult('API Base URL', 'success', window.__API_BASE__ || 'https://caregrid-backend.onrender.com');
            await testHealthEndpoint();
            await testClinicsEndpoint();
            await testAuthEndpoint();
        }
        
        // Run tests automatically on page load
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>